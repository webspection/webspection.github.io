<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
    <title>Webspection</title>
    <link rel="stylesheet" type="text/css" href="styles/style.css">
    <link rel="stylesheet" type="text/css" href="styles/framework.css">
    <link
        href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,500,500i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,700,700i,900,900i"
        rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="fonts/css/fontawesome-all.min.css">
    <!-- Don't forget to update PWA version (must be same) in pwa.js & manifest.json -->
    <link rel="manifest" href="_manifest.json" data-pwa-version="set_by_pwa.js">
    <link rel="apple-touch-icon" sizes="180x180" href="app/icons/icon-192x192.png">
    <style>
        .message {
            margin-bottom: 15px;
        }

        .image {
            float: left;
            margin-right: 10px;
        }

        .user {
            float: left;
            font-weight: bold;
            color: #009;
            margin-bottom: 5px;
        }

        .content {
            margin-left: 30px;
            font-style: italic;
        }

        .colored {
            color: #6e63fe;
        }

        .small,
        p {
            font-size: small;
        }

        textarea {
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            background-color: #292d3f;
            color: white;
            font-size: small;
        }

        #blocklyContainer {
            position: relative;
            width: 100%;
            height: 50vh;
        }

        #blocklyDiv {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        img {
            display: block;
            width: 100%;
            height: auto;
        }
    </style>
</head>

<body class="theme-light" data-gradient="gradient-1">

    <div id="page">

        <div id="page-preloader">
            <div class="loader-main">
                <div class="preload-spinner"></div>
            </div>
        </div>

        <div class="header header-fixed header-logo-app">
            <h1 class="content top-15">ⓦ Webspection</h1>
            <a href="#" class="back-button header-icon header-icon-1"><i class="fas fa-arrow-left font-13"></i></a>
            <a href="#" class="header-icon header-icon-2" data-menu="menu-settings"><i
                    class="fas fa-cog fa-spin font-13"></i></a>
            <a href="#" class="header-icon header-icon-3" data-toggle-theme><i class="fas fa-moon"></i></a>
        </div>

        <div class="footer-menu footer-5-icons shadow-huge shadow-huge">
            <a href=""><i class="fa fa-heart"></i><span></span></a>
            <a href="page-about.html"><i class="fa fa-gift"></i><span>About</span></a>
            <a href="index.html" class="active-nav"><i class="fa fa-home"></i><span>Home</span></a>
            <a href="media.html"><i class="fa fa-image"></i><span>Tutorial</span></a>
            <a href="page-contact.html"><i class="fa fa-gift"></i><span>Create</span></a>
            <div class="clear"></div>
        </div>

        <div class="page-bg">
            <div></div>
        </div>
        <div id="notification-5" class="notification-style notification-android bg-green1-dark">
            <i class="fa fa-check color-green1-dark bg-white"></i>
            <h1 class="font-15">Success!</h1>
            <strong>Time</strong>
            <p>
                Congratulations! You have completed the tutorial!
            </p>
            <div class="notification-buttons">
                <div class="one-half">
                    <a href="#"><i class="fa fa-info-circle"></i>Find out More</a>
                </div>
                <div class="one-half">
                    <a href="#"><i class="fa fa-arrow-right"></i>Thank you</a>
                </div>
                <div class="clear"></div>
            </div>
        </div>
        <div class="page-content header-clear-large">

            <a id="alertButton" style="display: none" href="#" data-notification="notification-5" class="no-border"><i
                    class="font-16 fa fa-check-square color-green1-dark"></i><span>Confirmation Alert</span><i
                    class="fa fa-angle-right"></i></a>

            <div style="display: none" class="content content-box round-medium shadow-huge bg-blue2-dark">
                <h4 class="color-white bold top-10">Paste Your Seed Here</h4>
                <textarea class="content" id="xmlCode" rows="10" cols="35"></textarea>
                <button class="button shadow-huge button-m button-circle bg-yellow2-dark"
                    onclick="generate()">Generate</button>
            </div>

            <div class="content content-box round-medium shadow-huge">
                <h4 id="tutorialName" class="bold">Automated Threat</h4>
                <div style="width: 50%; float:left">
                    <p id="tutorialContent" class="bottom-0">
                        This is a threat events to applications undertaken using automated
                        actions. The focus is on abuse of functionality - misuse of inherent functionality and related
                        design flaws
                    </p>
                </div>
                <div style="width: 40%; float:right">
                    <img style="background-color: white;" src="images/phishing.PNG" />
                </div>
            </div>

            <div class="content content-box round-medium shadow-huge">
                <h4 class="bold">What is CSRF attack?</h4>
                <p class="bottom-0">
                    It is an attack that forces a user to execute unwanted actions on the web server which they are
                    authenticated. The attacker can use CSRF attack to trick users of a website to execute actions from
                    the attacker
                </p>
                <br>
                <h4 class="bold">What is the danger of CSRF attack?</h4>
                <p class="bottom-0">
                    The attacker use CSRF attack to force users to perform requests such as fund transfer, change email
                    address and more. If the victim is the admin of the website, CSRF attack can compromise the whole
                    website
                </p>
            </div>
            <script>
                function openInNewTab(url) {
                    var win = window.open(url);
                    win.focus();
                }
            </script>
            <div class="content content-box round-medium shadow-huge bg-blue2-dark">
                <h4 class="color-white bold top-10">Your Task</h4>
                <p id="tutorialTask" class="color-white bottom-10">
                    Create a program to create bulk accounts
                </p>
                <button onclick="openInNewTab('how-to-play.html');"
                    class="button shadow-huge button-s button-circle bg-yellow2-dark">How to play?</button>
            </div>

            <div class="content content-box round-medium shadow-huge bg-blue2-dark">
                <div style="width: 50%; float:left">
                    <h4 class="color-white bold top-10">Hints</h4>
                    <p style="display: none" id="hints" class="color-white bottom-10">
                        You can use a loop to create multiple accounts</p>
                    <p id="hint" class="color-white bottom-10">
                        You can use a loop to create multiple accounts</p>
                </div>
                <div style="width: 50%; float:right">
                    <h4 class="color-white bold top-10">Visualization</h4>
                    <img style="background-color: white;" id="my_image" src="images/sa1.png" />
                </div>
            </div>

            <div id="blockWorkspace" class="content content-box round-medium shadow-huge bg-blue2-dark">
            </div>

            <div class="content content-box round-medium shadow-huge bg-blue2-dark">
                <h4 class="color-white bold top-10">Compiler</h4>
                <textarea class="content" id="textarea" rows="10" cols="35"></textarea>
            </div>

            <div class="footer" data-footer-load="menu-footer.html"></div>
        </div>

        <!-- Page Menus -->
        <div id="menu-share" class="menu-box menu-box-detached round-medium" data-menu-type="menu-box-bottom"
            data-menu-height="390" data-menu-load="menu-share.html" data-menu-effect="menu-over">
        </div>

        <div id="menu-settings" class="menu-box menu-box-gradient" data-menu-type="menu-box-modal"
            data-menu-height="100%" data-menu-width="100%" data-menu-load="menu-settings.html"
            data-menu-effect="menu-over">
        </div>

        <div class="menu-hider"></div>
    </div>

    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/plugins.js"></script>
    <script type="text/javascript" src="scripts/custom.js" async></script>

    <script src="js/blockly_compressed.js"></script>
    <script src="js/blocks_compressed.js"></script>
    <script src="js/javascript_compressed.js"></script>
    <script src="js/en.js"></script>
    <script>
        Blockly.Blocks['print'] = {
            init: function () {
                this.appendValueInput("NAME")
                    .setCheck(null)
                    .appendField("print");
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour(230);
                this.setTooltip("");
                this.setHelpUrl("");
            }
        };
        Blockly.JavaScript['print'] = function (block) {
            var value_name = Blockly.JavaScript.valueToCode(block, 'NAME', Blockly.JavaScript.ORDER_ATOMIC);
            // TODO: Assemble JavaScript into code variable.
            var code = 'console.log("' + value_name + '");\n';
            return code;
        };
        Blockly.Blocks['create_account'] = {
            init: function () {
                this.appendDummyInput()
                    .appendField("create account");
                this.setPreviousStatement(true, null);
                this.setColour(65);
                this.setTooltip("");
                this.setHelpUrl("");
            }
        };
        Blockly.JavaScript['create_account'] = function (block) {
            // TODO: Assemble JavaScript into code variable.
            var code = '$("#register").click();\n';
            return code;
        };
        Blockly.Blocks['set_value'] = {
            init: function () {
                this.appendValueInput("variable")
                    .setCheck(null)
                    .appendField("set");
                this.appendValueInput("value")
                    .setCheck(null)
                    .appendField("=");
                this.setInputsInline(true);
                this.setPreviousStatement(true, null);
                this.setNextStatement(true, null);
                this.setColour(210);
                this.setTooltip("");
                this.setHelpUrl("");
            }
        };
        Blockly.JavaScript['set_value'] = function (block) {
            var value_variable = Blockly.JavaScript.valueToCode(block, 'variable', Blockly.JavaScript.ORDER_ATOMIC);
            var value_value = Blockly.JavaScript.valueToCode(block, 'value', Blockly.JavaScript.ORDER_ATOMIC);
            // TODO: Assemble JavaScript into code variable.
            var code = '$("' + value_variable + '").val("' + value_value + '")\n';
            return code;
        };
        Blockly.Blocks['password'] = {
            init: function () {
                this.appendDummyInput()
                    .appendField("password");
                this.setOutput(true, null);
                this.setColour(160);
                this.setTooltip("");
                this.setHelpUrl("");
            }
        };
        Blockly.JavaScript['password'] = function (block) {
            // TODO: Assemble JavaScript into code variable.
            var code = '#password';
            // TODO: Change ORDER_NONE to the correct strength.
            return [code, Blockly.JavaScript.ORDER_NONE];
        };
        Blockly.Blocks['randomstring'] = {
            init: function () {
                this.appendDummyInput()
                    .appendField("random string");
                this.setInputsInline(false);
                this.setOutput(true, null);
                this.setColour(290);
                this.setTooltip("");
                this.setHelpUrl("");
            }
        };
        Blockly.JavaScript['randomstring'] = function (block) {
            // TODO: Assemble JavaScript into code variable.
            var code = 'Math.random().toString(36).substring(7);';
            // TODO: Change ORDER_NONE to the correct strength.
            return [code, Blockly.JavaScript.ORDER_NONE];
        };
        Blockly.Blocks['username'] = {
            init: function () {
                this.appendDummyInput()
                    .appendField("username");
                this.setOutput(true, null);
                this.setColour(160);
                this.setTooltip("");
                this.setHelpUrl("");
            }
        };
        Blockly.JavaScript['username'] = function (block) {
            // TODO: Assemble JavaScript into code variable.
            var code = '#username';
            // TODO: Change ORDER_NONE to the correct strength.
            return [code, Blockly.JavaScript.ORDER_NONE];
        };
        Blockly.Blocks['string_length'] = {
            init: function () {
                this.appendValueInput('VALUE')
                    .setCheck('String')
                    .appendField('length of');
                this.setOutput(true, 'Number');
                this.setColour(160);
                this.setTooltip('Returns number of letters in the provided text.');
                this.setHelpUrl('http://www.w3schools.com/jsref/jsref_length_string.asp');
            }
        };
        Blockly.JavaScript['string_length'] = function (block) {
            // String or array length.
            var argument0 = Blockly.JavaScript.valueToCode(block, 'VALUE',
                Blockly.JavaScript.ORDER_FUNCTION_CALL) || '\'\'';
            return [argument0 + '.length', Blockly.JavaScript.ORDER_MEMBER];
        };


    </script>
    <script id="lzutf8" src="https://cdn.jsdelivr.net/npm/lzutf8/build/production/lzutf8.js"></script>
    <script>
        //paste the seed here
        var seed = "Q3Jvc3MgU2l0ZSBSZXF1ZXN0IEZvcmdlcnkmQ3Jvc3MtU2l0ZSBSZXF1ZXN0IEZvcmdlcnkgJTI4Q1NSRiUyOSBpcyBhbiBhdHRhY2sgdGhhdCBmb3JjZXMgYW4gZW5kIHVzZXIgdG8gZXhlY3V0ZSB1bndhbnRlZCBhY3Rpb25zIG9uIGEgd2ViIGFwcGxpY2F0aW9uIGluIHdoaWNoIHRoZXklRTIlODAlOTlyZSBjdXJyZW50bHkgYXV0aGVudGljYXRlZCZUcnkgdG8gY3JlYXRlIGEgcHJvZ3JhbSB0byBzaW11bGF0ZSBDU1JGIGF0dGFjayZhbiBhdHRhY2tlciBtYXkgdHJpY2sgdGhlIHVzZXJzIG9mIGEgd2ViIGFwcGxpY2F0aW9uIGludG8gZXhlY3V0aW5nIGFjdGlvbnMgb2YgdGhlIGF0dGFja2VyJUUyJTgwJTk5cyBjaG9vc2luZyYgICAgICAgICAgICAgICAgPGg0IGlkPSJzb2x1dGlvbiIgY2xhc3M9ImNvbG9yLXdoaXRlIGJvbGQgdG9wLTEwIj5DcmVhdGUgWW91ciBTb2x1dGlvbjwvaDQ+ICAgICAgICAgICAgICAgIDxzZWN0aW9uIGlkPSJibG9ja2x5Q29udGFpbmVyIj4gICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImJsb2NrbHlEaXYiIHN0eWxlPSJ3aWR0aDogMTAwJSI+PC9kaXY+ICAgICAgICAgICAgICAgICAgICA8eG1sIGlkPSJ0b29sYm94IiBzdHlsZT0iZGlzcGxheTogbm9uZSI+ICAgICAgICA8YmxvY2sgdHlwZT0iYXR0YWNrZXIiPjwvYmxvY2s+PGJsb2NrIHR5cGU9InZpY3RpbSI+PC9ibG9jaz48YmxvY2sgdHlwZT0id2Vic2l0ZSI+PC9ibG9jaz48YmxvY2sgdHlwZT0iZm9yZ2UgcmVxdWVzdCBmb3Igd2Vic2l0ZSI+PC9ibG9jaz48YmxvY2sgdHlwZT0iZW1iZWQgcmVxdWVzdCB0byBoeXBlcmxpbmsiPjwvYmxvY2s+PGJsb2NrIHR5cGU9ImNsaWNrIG9uIHRoZSBoeXBlcmxpbmsiPjwvYmxvY2s+PGJsb2NrIHR5cGU9ImZvcmdlZCByZXF1ZXN0IGFjdGl2YXRlZCI+PC9ibG9jaz4gICAgICAgICAgICAgICAgICAgIDwveG1sPiAgICAgICAgICAgICAgICA8L3NlY3Rpb24+ICAgICAgICAmYXR0YWNrZXIoIihmb3JnZXJlcXVlc3Rmb3J3ZWJzaXRlKSIpO2F0dGFja2VyKCIoZW1iZWRyZXF1ZXN0dG9oeXBlcmxpbmspIik7dmljdGltKCIoY2xpY2tvbnRoZWh5cGVybGluaykiKTt3ZWJzaXRlKCIoZm9yZ2VkcmVxdWVzdGFjdGl2YXRlZCkiKTsmICAgICAgICAgICAgQmxvY2tseS5CbG9ja3NbJ2F0dGFja2VyJ10gPSB7ICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRWYWx1ZUlucHV0KCJOQU1FIikgICAgICAgICAgICAgICAgICAgIC5zZXRDaGVjayhudWxsKSAgICAgICAgICAgICAgICAgICAgLmFwcGVuZEZpZWxkKCJhdHRhY2tlciIpOyAgICAgICAgICAgICAgICB0aGlzLnNldFByZXZpb3VzU3RhdGVtZW50KHRydWUsIG51bGwpOyAgICAgICAgICAgICAgICB0aGlzLnNldE5leHRTdGF0ZW1lbnQodHJ1ZSwgbnVsbCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29sb3VyKDIzMCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcCgiIik7ICAgICAgICAgICAgICAgIHRoaXMuc2V0SGVscFVybCgiIik7ICAgICAgICAgICAgfSAgICAgICAgfTsgICAgICAgIEJsb2NrbHkuSmF2YVNjcmlwdFsnYXR0YWNrZXInXSA9IGZ1bmN0aW9uIChibG9jaykgeyAgICAgICAgICAgIHZhciB2YWx1ZV9uYW1lID0gQmxvY2tseS5KYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTkFNRScsIEJsb2NrbHkuSmF2YVNjcmlwdC5PUkRFUl9BVE9NSUMpOyAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2RlID0gJ2F0dGFja2VyKCInICsgdmFsdWVfbmFtZSArICciKTtcbic7ICAgICAgICAgICAgcmV0dXJuIGNvZGU7ICAgICAgICB9OyAgICAgICAgICAgICAgICAgICAgICAgIEJsb2NrbHkuQmxvY2tzWyd2aWN0aW0nXSA9IHsgICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkgeyAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFZhbHVlSW5wdXQoIk5BTUUiKSAgICAgICAgICAgICAgICAgICAgLnNldENoZWNrKG51bGwpICAgICAgICAgICAgICAgICAgICAuYXBwZW5kRmllbGQoInZpY3RpbSIpOyAgICAgICAgICAgICAgICB0aGlzLnNldFByZXZpb3VzU3RhdGVtZW50KHRydWUsIG51bGwpOyAgICAgICAgICAgICAgICB0aGlzLnNldE5leHRTdGF0ZW1lbnQodHJ1ZSwgbnVsbCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29sb3VyKDIzMCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcCgiIik7ICAgICAgICAgICAgICAgIHRoaXMuc2V0SGVscFVybCgiIik7ICAgICAgICAgICAgfSAgICAgICAgfTsgICAgICAgIEJsb2NrbHkuSmF2YVNjcmlwdFsndmljdGltJ10gPSBmdW5jdGlvbiAoYmxvY2spIHsgICAgICAgICAgICB2YXIgdmFsdWVfbmFtZSA9IEJsb2NrbHkuSmF2YVNjcmlwdC52YWx1ZVRvQ29kZShibG9jaywgJ05BTUUnLCBCbG9ja2x5LkphdmFTY3JpcHQuT1JERVJfQVRPTUlDKTsgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29kZSA9ICd2aWN0aW0oIicgKyB2YWx1ZV9uYW1lICsgJyIpO1xuJzsgICAgICAgICAgICByZXR1cm4gY29kZTsgICAgICAgIH07ICAgICAgICAgICAgICAgICAgICAgICAgQmxvY2tseS5CbG9ja3NbJ3dlYnNpdGUnXSA9IHsgICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkgeyAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZFZhbHVlSW5wdXQoIk5BTUUiKSAgICAgICAgICAgICAgICAgICAgLnNldENoZWNrKG51bGwpICAgICAgICAgICAgICAgICAgICAuYXBwZW5kRmllbGQoIndlYnNpdGUiKTsgICAgICAgICAgICAgICAgdGhpcy5zZXRQcmV2aW91c1N0YXRlbWVudCh0cnVlLCBudWxsKTsgICAgICAgICAgICAgICAgdGhpcy5zZXROZXh0U3RhdGVtZW50KHRydWUsIG51bGwpOyAgICAgICAgICAgICAgICB0aGlzLnNldENvbG91cigyMzApOyAgICAgICAgICAgICAgICB0aGlzLnNldFRvb2x0aXAoIiIpOyAgICAgICAgICAgICAgICB0aGlzLnNldEhlbHBVcmwoIiIpOyAgICAgICAgICAgIH0gICAgICAgIH07ICAgICAgICBCbG9ja2x5LkphdmFTY3JpcHRbJ3dlYnNpdGUnXSA9IGZ1bmN0aW9uIChibG9jaykgeyAgICAgICAgICAgIHZhciB2YWx1ZV9uYW1lID0gQmxvY2tseS5KYXZhU2NyaXB0LnZhbHVlVG9Db2RlKGJsb2NrLCAnTkFNRScsIEJsb2NrbHkuSmF2YVNjcmlwdC5PUkRFUl9BVE9NSUMpOyAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2RlID0gJ3dlYnNpdGUoIicgKyB2YWx1ZV9uYW1lICsgJyIpO1xuJzsgICAgICAgICAgICByZXR1cm4gY29kZTsgICAgICAgIH07ICAgICAgICAgICAgICAgICAgICAgICAgQmxvY2tseS5CbG9ja3NbJ2ZvcmdlIHJlcXVlc3QgZm9yIHdlYnNpdGUnXSA9IHsgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7ICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kRHVtbXlJbnB1dCgpICAgICAgICAgICAgICAgICAgICAuYXBwZW5kRmllbGQoImZvcmdlIHJlcXVlc3QgZm9yIHdlYnNpdGUiKTsgICAgICAgICAgICAgICAgdGhpcy5zZXRPdXRwdXQodHJ1ZSwgbnVsbCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29sb3VyKDE2MCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcCgiIik7ICAgICAgICAgICAgICAgIHRoaXMuc2V0SGVscFVybCgiIik7ICAgICAgICAgICAgfSAgICAgICAgfTsgICAgICAgIEJsb2NrbHkuSmF2YVNjcmlwdFsnZm9yZ2UgcmVxdWVzdCBmb3Igd2Vic2l0ZSddID0gZnVuY3Rpb24gKGJsb2NrKSB7ICAgICAgICAgICAgdmFyIGNvZGUgPSAnZm9yZ2UgcmVxdWVzdCBmb3Igd2Vic2l0ZSc7ICAgICAgICAgICAgcmV0dXJuIFtjb2RlLCBCbG9ja2x5LkphdmFTY3JpcHQuT1JERVJfTk9ORV07ICAgICAgICAgICAgICAgICAgICB9OyAgICAgICAgICAgICAgICAgICAgICAgIEJsb2NrbHkuQmxvY2tzWydlbWJlZCByZXF1ZXN0IHRvIGh5cGVybGluayddID0geyAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmREdW1teUlucHV0KCkgICAgICAgICAgICAgICAgICAgIC5hcHBlbmRGaWVsZCgiZW1iZWQgcmVxdWVzdCB0byBoeXBlcmxpbmsiKTsgICAgICAgICAgICAgICAgdGhpcy5zZXRPdXRwdXQodHJ1ZSwgbnVsbCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29sb3VyKDE2MCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcCgiIik7ICAgICAgICAgICAgICAgIHRoaXMuc2V0SGVscFVybCgiIik7ICAgICAgICAgICAgfSAgICAgICAgfTsgICAgICAgIEJsb2NrbHkuSmF2YVNjcmlwdFsnZW1iZWQgcmVxdWVzdCB0byBoeXBlcmxpbmsnXSA9IGZ1bmN0aW9uIChibG9jaykgeyAgICAgICAgICAgIHZhciBjb2RlID0gJ2VtYmVkIHJlcXVlc3QgdG8gaHlwZXJsaW5rJzsgICAgICAgICAgICByZXR1cm4gW2NvZGUsIEJsb2NrbHkuSmF2YVNjcmlwdC5PUkRFUl9OT05FXTsgICAgICAgICAgICAgICAgICAgIH07ICAgICAgICAgICAgICAgICAgICAgICAgQmxvY2tseS5CbG9ja3NbJ2NsaWNrIG9uIHRoZSBoeXBlcmxpbmsnXSA9IHsgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7ICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kRHVtbXlJbnB1dCgpICAgICAgICAgICAgICAgICAgICAuYXBwZW5kRmllbGQoImNsaWNrIG9uIHRoZSBoeXBlcmxpbmsiKTsgICAgICAgICAgICAgICAgdGhpcy5zZXRPdXRwdXQodHJ1ZSwgbnVsbCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0Q29sb3VyKDE2MCk7ICAgICAgICAgICAgICAgIHRoaXMuc2V0VG9vbHRpcCgiIik7ICAgICAgICAgICAgICAgIHRoaXMuc2V0SGVscFVybCgiIik7ICAgICAgICAgICAgfSAgICAgICAgfTsgICAgICAgIEJsb2NrbHkuSmF2YVNjcmlwdFsnY2xpY2sgb24gdGhlIGh5cGVybGluayddID0gZnVuY3Rpb24gKGJsb2NrKSB7ICAgICAgICAgICAgdmFyIGNvZGUgPSAnY2xpY2sgb24gdGhlIGh5cGVybGluayc7ICAgICAgICAgICAgcmV0dXJuIFtjb2RlLCBCbG9ja2x5LkphdmFTY3JpcHQuT1JERVJfTk9ORV07ICAgICAgICAgICAgICAgICAgICB9OyAgICAgICAgICAgICAgICAgICAgICAgIEJsb2NrbHkuQmxvY2tzWydmb3JnZWQgcmVxdWVzdCBhY3RpdmF0ZWQnXSA9IHsgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7ICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kRHVtbXlJbnB1dCgpICAgICAgICAgICAgICAgICAgICAuYXBwZW5kRmllbGQoImZvcmdlZCByZXF1ZXN0IGFjdGl2YXRlZCIpOyAgICAgICAgICAgICAgICB0aGlzLnNldE91dHB1dCh0cnVlLCBudWxsKTsgICAgICAgICAgICAgICAgdGhpcy5zZXRDb2xvdXIoMTYwKTsgICAgICAgICAgICAgICAgdGhpcy5zZXRUb29sdGlwKCIiKTsgICAgICAgICAgICAgICAgdGhpcy5zZXRIZWxwVXJsKCIiKTsgICAgICAgICAgICB9ICAgICAgICB9OyAgICAgICAgQmxvY2tseS5KYXZhU2NyaXB0Wydmb3JnZWQgcmVxdWVzdCBhY3RpdmF0ZWQnXSA9IGZ1bmN0aW9uIChibG9jaykgeyAgICAgICAgICAgIHZhciBjb2RlID0gJ2ZvcmdlZCByZXF1ZXN0IGFjdGl2YXRlZCc7ICAgICAgICAgICAgcmV0dXJuIFtjb2RlLCBCbG9ja2x5LkphdmFTY3JpcHQuT1JERVJfTk9ORV07ICAgICAgICAgICAgICAgICAgICB9OyAgICAgICAgICAgIA==";
        generate();
        function generate() {
            // stuff you want to do every second
            xmlSourceCode = atob(seed);
            var xmlList = xmlSourceCode.split('&');
            $("#tutorialName").html(decodeURIComponent(xmlList[0]));
            $("#tutorialContent").html(decodeURIComponent(xmlList[1]));
            $("#tutorialTask").html(decodeURIComponent(xmlList[2]));
            $("#hints").html(xmlList[3]);
            $("#blockWorkspace").html(xmlList[4]);
            console.log(xmlList[6]);
            eval(xmlList[6]);

            var xmlSourceCode = "";
            var options = {
                toolbox: toolbox,
                collapse: false,
                comments: false,
                disable: false,
                maxBlocks: Infinity,
                trashcan: false,
                horizontalLayout: true,
                toolboxPosition: 'start',
                css: true,
                media: 'https://blockly-demo.appspot.com/static/media/',
                rtl: false,
                scrollbars: false,
                sounds: true,
                oneBasedIndex: true,
                zoom: {
                    controls: false,
                    wheel: false,
                    startScale: 0.7,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                }
            };
            var workspace = Blockly.inject('blocklyDiv', options);

            function sleep(delay) {
                var start = new Date().getTime();
                while (new Date().getTime() < start + delay);
            }
            function myUpdateFunction(event) {
                var code = Blockly.JavaScript.workspaceToCode(workspace);
                document.getElementById('textarea').value = code;
                var targetStr = xmlList[5];
                if (document.getElementById('textarea').value.replace(/(\r\n|\n|\r)/gm, "").replace(/ /g, '').includes(targetStr)) {
                    $("#alertButton").click();
                }
            }
            workspace.addChangeListener(myUpdateFunction);
        }

        $(function () {
            setInterval(detectTextArea, 1000);
        });
        function found(lookupValue, testString) {
            return testString.indexOf(lookupValue) !== -1;
        }

        function detectTextArea() {
            var code = document.getElementById('textarea').value;
            var hintstr = "";
            var flag = 0;

            var cs1 = false;
            var cs2 = false;
            var cs3 = false;
            var cs4 = false;

            if (!found("attacker(\"(forge request for website)\")", code)) {
                hintstr += "<b><span style=\"color:red\">• Try to forge the request for the website</span></b><br>";
            } else {
                hintstr += "<b><span style=\"color:lightgreen\">• Correct! The request for the website is forged</span></b><br>";
                cs1 = true;
            }

            if (!found("attacker(\"(embed request to hyperlink)\")", code)) {
                hintstr += "<b><span style=\"color:red\">• The hyperlink is not embedded</span></b><br>";
            } else {
                hintstr += "<b><span style=\"color:lightgreen\">• Correct! The hyperlink is now embedded</span></b><br>";
                cs2 = true;
            }

            if (!found("victim(\"(click on the hyperlink)\")", code)) {
                hintstr += "<b><span style=\"color:red\">• The attack will not work if the victim does not click on the hyperlink</span></b><br>";
            } else {
                hintstr += "<b><span style=\"color:lightgreen\">• Correct! The victim has clicked on the hyperlink</span></b><br>";
                cs3 = true;
            }

            if (!found("website(\"(forged request activated)\")", code)) {
                hintstr += "<b><span style=\"color:red\">• The server has not activated the forged request</span></b><br>";
            } else {
                hintstr += "<b><span style=\"color:lightgreen\">• Correct! The server has activated the forged request</span></b><br>";
                cs4 = true;
            }
            if (cs1) {
                $("#my_image").attr("src", "images/csrf2.png");
                if (cs2) {
                    $("#my_image").attr("src", "images/csrf3.png");
                    if (cs3) {
                        $("#my_image").attr("src", "images/csrf4.png");
                        if (cs4) {
                            $("#my_image").attr("src", "images/csrf5.png");
                        }
                    }
                }
            } else {
                $("#my_image").attr("src", "images/csrf1.png");
            }

            $("#hint").html(hintstr);
        }
    </script>
</body>